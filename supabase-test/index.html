<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  const SUPABASE_URL = 'https://sklhiwupeisypbnzlnfr.supabase.co';
  const SUPABASE_ANON_KEY = 'PASTE-YOUR-ANON-KEY-HERE'; // no quotes around it in Netlify env, no spaces

  const statusEl = document.getElementById('status');
  const detailsEl = document.getElementById('details');

  try {
    // optional: also verify the SDK can be created
    createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 1) hit REST root with BOTH headers
    const res = await fetch(`${SUPABASE_URL}/rest/v1/`, {
      headers: {
        apikey: SUPABASE_ANON_KEY,
        Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
      },
    });

    const text = await res.text();
    if (!res.ok) {
      statusEl.textContent = `HTTP ${res.status}`;
      detailsEl.textContent = text;
      return;
    }

    statusEl.textContent = 'Connected to Supabase âœ…';
    detailsEl.textContent = text || '(ok)';
  } catch (e) {
    statusEl.textContent = 'Error connecting';
    detailsEl.textContent = e?.message || String(e);
  }
</script>
